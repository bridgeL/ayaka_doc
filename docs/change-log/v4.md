# v4 - 正在使用

## 0.4.1 

### API变更

相比0.3.x进行了api的大幅度更换

已过时的API：

- `on_command`
- `on_text`
- `on_state_command`
- `on_state_text`
- `group_storage`
- `plugin_storage`
- `set_state`

新的API：

- `on`
- `storage`

通过这种方式，便于后续拓展ayaka的功能，例如添加异步sql读写支持

重新将ayaka功能拆分为多个文件，以便后续拓展开发

### 修复app.arg在特定情况下的错误

修复了命令抬头为空字符串时，app.arg错误解析的问题   

## 0.4.2 

1. 增进了app.cache的使用体验，添加了chain方法
2. 优化了app.cache的运行逻辑，不影响使用
3. 大幅修改了`app.storage`的使用方法，现在`app.storage`与`app.cache`有着相似的使用逻辑，降低心智负担
4. 重新添加了`app.set_state`方法

## 0.4.3b0

ayaka内置bot：ayakabot（可作为cqhttp的后端）

现在，即使不安装nonebot，ayaka仍可与cqhttp通信

**可兼容**：所有通过ayaka编写的ayaka衍生插件，都可以在ayakabot和nonebot下使用

**cqhttp**：ayakabot仍然是围绕cqhttp而使用的qq机器人

**配置**：配置cqhttp为反向ws连接，连接地址为 `ws://127.0.0.1:19900/ayakabot`

相应的，入口文件需替换为

```py
# bot.py
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from ayaka.config import fastapi_reload
from ayaka.ayakabot import run, load_plugins


if not fastapi_reload or __name__ == "__mp_main__":
    load_plugins("plugins")

if __name__ == "__main__":
    run(reload=fastapi_reload)
```

## 0.4.3b1

1. 修改了缓存和持久化中的AyakaCacheCtrl和AyakaJsonFileCtrl的变量成员的名称

    `AyakaCacheCtrl`.data -> `AyakaCacheCtrl`._data

    `AyakaCacheCtrl`.keys -> `AyakaCacheCtrl`._keys

    `AyakaJsonFileCtrl`.path -> `AyakaJsonFileCtrl`._path
    
    `AyakaJsonFileCtrl`.data -> `AyakaJsonFileCtrl`._data

2. 添加了api文档（自动生成）

